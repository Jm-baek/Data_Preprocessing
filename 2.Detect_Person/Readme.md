### 본 프로젝트는 CNN과 Object Detection 분야를 조금씩 알게 되는 과정으로 작성되었습니다.


## 1. yolov4 model 무작정 학습시켜보기
yolov4로 진행을 하고 있어서 yolov4 모델을 사용하여 학습을 진행.<br/>
yolov4는 darknet이라는 자기만의 개성있는 프레임워크 툴을 사용하고 있다.<br/>

Darknet은 개성이 있는 만큼 간편하게 학습이 가능하지만,<br/>
장기적으로 모델의 세부적인 부분을 접근할 때는 tensorflow나 keras가 좋지 않을까 생각한다.<br/>
darknet tool을 처음 접하고 어떻게 작동되는지 잘 모르지만 학습을 진행할 수 있었다.<br/>

**object detection**  
Real time으로 detection 결과를 확인하기 위해서는 FPS가 높게 나오는 모델을 고려(FPS와 detection 성능은 trade-off관계)
1. one-stage-detection  
2. two-stage-detection  

**사용 데이터**  
coco dataset , open images 중에서 선별해서 이미지를 사용하고 있다.  

### 진행 과정
#### 1. yolov4 model 및 사람 데이터 
- yolov4의 pre-train 된 모델과 weight를 사용하면 어느 정도 사람을 인지 가능
- coco dataset을 기반으로 학습했는데 coco dataset에서는 사람의 손도 person으로 잡는 등 사람의 일부분을 사람으로 잡고 있다.
- 엄청 작은 부분까지 person으로 학습된 모델이기 때문에 다른 영상으로 테스트할 경우, 멀리 있는 새를 사람으로 잡고 있다.
- 서비스를 제공하는 입장에서 안정적인 정확도(90% 이상에서 일정하게 유지)와 최대한 오인률?(사람이 아닌 것을 사람으로 인식)을 낮춰야한다.

#### 2. yolov4x-mish 및 yolov4-csp model 사용
- 모델 학습은 가능하고 detection도 잘 된다.
- 하지만 모델 학습 과정에서 안정적이지 못한 loss 결과를 확인할 수 있다.
- yolov4와 다르게 조금 더 object를 detail?하게 잡아주는 성능을 보여준다.
- 모델 학습 과정의 불안정으로 두 모델은 일단 사용하지 않기로 했다.

mAP는 100%??가 나오는데 loss가 왜 저렇게 튀는지 모르겠다.
![image](https://user-images.githubusercontent.com/57121112/122663993-7cfd1000-d1d9-11eb-9a1f-5ecfc9736ec3.png)


#### 3. 어떻게 특정 행동(action)을 잡을 수 있을까?(쓰러짐과 서 있는 사람 구별)
person과 fallen person 이렇게 나눠서 학습을 진행해야될까???
- 먼저 쓰러진 사람, 서있는 사람 모두 person으로 학습을 진행했다.
- 결과는 매우 괜찮게 나오고 있다. class를 두 개로 나눠서 학습할 필요는 없는 듯하다.
- 하지만, 사람의 쓰러지는 모습은 다양하고 다양한 모습을 학습시키면서 사람 아닌 사물들을 사람으로 잡고 있다.  

고민      
 - 사람의 자세는 너무 다양한다.(어느 정도의 자세만 학습시켜도 다른 자세를 잡을 수 있었으면 좋겠다.)
 - 카메라 위치 및 자세 따라 사람으로 학습 시켜도 되는지 고민 되는 자세가 많다.
 - 모든 카메라 위치를 고려하여 사람을 잡는 모델을 만들 수 있는 것일까..?

![image](https://user-images.githubusercontent.com/57121112/120961845-8c239d00-c799-11eb-9b89-6b163cea922a.png)

구별 없이 학습을 시켰다~!  
![image](https://user-images.githubusercontent.com/57121112/122664055-e1b86a80-d1d9-11eb-8894-a01dd41cb11d.png)

#### 4. 이미지 증강(Image Augmentation)





#### 5. 이미지로만 학습을 진행해야하는 것일까?
어느 정도? yolov4 학습의 한계가 오고 있다고 생각을 한다.<br/>
매일 괜찮은 이미지 선별하여 추가하고 학습을 진행하는 것에 있어서.. 이렇게 하는 것이 옳은 일인지 의문점이 생기고 있다.  
또한 일주일동안 했던 업무 내용을 보면 이미지 정제, 이미지 증가, 추가 등등..(아르바이트하면 할 수 있는 작업을 열심히 하고있다)  

CNN분야가 모델을 자체적으로 만들기에는 힘들 수 있다는 것은 충분히 이해되지지만.. 다른 회사는 어떻게 작업하는지 매우 궁금하다.  

그리고 딥러닝이 아닌 opencv 공부를 위해 **"파이썬으로 만드는 OpenCV 프로젝트"** 책을 구매했다.


#### 6. 나무 등 사물 뒤에 있는 사람 학습(이미지 합성)
사용할 만한 이미지나 영상을 찾고 수집하는 과정까지 상당히 많은 시간이 소요된다.<br/>
기존 이미지에서 나무 이미지랑 합성을 하는 방법을 고려했다.  
나무 이미지는 png 파일을 사용 또는 jpg를 사용하더라도 배경을 투명하게 만드는 작업을 **opencv**나 **PIL**로 작업해야한다.
데이터 개수가 작은 문제도 있겠지만 이 작업으로 성능이 올라가지 않는 듯하다. 

![image](https://user-images.githubusercontent.com/57121112/122665117-5f7f7480-d1e0-11eb-8f93-13df0645e404.png)


#### 7. 이미지 화질 높이기(Image Super-Resolution)
계속 이미지 작업을 한다는 과정에서 모델 성능을 조금? 이라도 더 높이기 위해 방법을 찾아보았다.  
인터넷에서 이미지들을 수집하다 보면 화질이 떨어지는 사진들이 있다.  
화질이 높을 수록 모델의 성능도 높아진다고 하지만 어떻게 기존의 이미지 화질을 높일 수 있을까?? 고민을 해보았다.  
이미지 화질을 높이는 딥러닝 모델!?이 존재한다. 정말 신기하다. 한 번 공부해볼 가치가 있다고 생각한다.  

참고 사이트:  
https://www.youtube.com/watch?v=VxRCku4Bkgg  

https://www.youtube.com/watch?v=unf2ziKXBP4

최종 이미지 데이터 개수 시각화이다.(실력을 늘려서 더 직관적으로 그리도록 하겠습니다.)  

![image](https://user-images.githubusercontent.com/57121112/123611897-05fcf280-d83d-11eb-9cf8-4e5d71e6eab4.png)

------------ 나의 생각 Note -----------------
#### 6월 22일  
영상 -> 사전처리 -> yolov4 -> 후처리 -> 송출  

카메라나  cctv의 경우, 화질이 떨어지는 등의 문제가 있다.  
이를 개선하기 위해 모델에 들어가기 전 영상에서 제공하는 이미지들을 사전에 보정 작업을 할 수는 없을까?  
또는 yolov4 작업 후에서 결과를 조금 조정할 수 있지 않을까 라는 생각을 하고 있다.  

#### 6월 28일
케라스 코리아 오픈 채팅 방에서 재미있는 질문이 올라와서 캡쳐를 해놨다.  
나도 labeling 작업하면서 저렇게 겹쳐져 있는 부분을 어떻게 처리해야하는지 정말 고민을 많이했었는데    
다른 사람도 고민하고 있다는 부분에서 매우 행복했다?  

![image](https://user-images.githubusercontent.com/57121112/123582902-9cb7b800-d819-11eb-972d-83aca29d9513.png)



진행 중 ~ ing
